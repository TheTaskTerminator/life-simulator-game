# 结局系统设计指南

## 结局的设计哲学

**结局不是奖励或惩罚，而是"这个状态下已无法产生有意义的选择"的说明。**

好的结局系统应该让玩家说：
> "这次走了这条路，下次我想试试另一种活法。"

如果玩家看到结局后只说"啊，这次挂了"或"啊，通关了"，结局系统的设计可以更好。

## 硬结局 vs 软结局

| 类型 | 触发时机 | 触发条件 | 数量建议 |
|------|---------|---------|---------|
| **硬结局** | 任何时候（即时） | 属性达到临界值、时间耗尽 | 1-3 个 |
| **软结局** | 达到 maxTurn 时 | 综合评分 | 4-6 个 |

## 硬结局设计

### 属性归零结局

```typescript
{
  id: 'ending_exhausted',
  title: '精力耗尽',
  description: '长期高压让你精力崩溃，不得不退出这场竞争。这不是终点，而是一种保护。',
  type: 'bad',
  condition: {
    attributes: { energy: { max: 0 } }
  }
}
```

**要点**：
- 结局描述要有同理心，不要只是"你失败了"
- `type: 'bad'` 但描述不一定全是负面（退出也是一种选择）

### 时间到达结局

通常 `maxTurn` 到达时直接评价软结局，但有时也会有"时间到了"的硬结局：

```typescript
{
  id: 'ending_time_up',
  title: '岁月如梭',
  description: '180天的职场历程就此结束，无论结果如何，你已经完整地走过了这段旅程。',
  type: 'neutral',
  condition: {
    age: { min: 180 }
  }
}
```

## 软结局设计

### 4 级经典结构

```
评分范围     结局类型
≥ 0.8        good   - 最佳结局（需要玩家非常努力才能达到）
≥ 0.6        good   - 良好结局（正常认真游戏可达到）
≥ 0.4        neutral - 一般结局（随意游戏的结果）
≥ 0.0        bad    - 遗憾结局（大量做出错误选择）
```

**注意**：最后一个结局的 `scoreThreshold` 必须为 `0`，确保任何情况都能匹配到结局。

### 评价函数设计

评价函数的**权重选择体现话题的价值取向**：

```typescript
// 人生模拟器：健康最重要（0.4），然后是财富和幸福（各0.3）
health * 0.4 + wealth_normalized * 0.3 + happiness * 0.3

// 职场模拟器：能力最重要（0.4），人际关系次之（0.3），收入（0.3）
skill * 0.4 + network * 0.3 + salary_normalized * 0.3
```

改变权重就改变了游戏鼓励的"正确活法"。

### 资源属性归一化

财富等无上限属性需要设定一个"参考天花板"用于归一化：

```typescript
// 假设年收入 50万 是"圆满"的参考值
wealth_normalized = Math.min(player.attributes.wealth / 500000, 1)
```

超过参考值的财富不会继续提升评分（避免疯狂氪金的最优解）。

## 结局数量建议

- **少于 4 个**：体验趋同，重开动力弱，玩家很快看完所有结局
- **4-6 个**：黄金区间，有足够差异但又不会让设计师失焦
- **超过 8 个**：设计维护困难，AI 生成内容难以适配所有结局

## 差异化结局描述

**避免模板化**：

```
❌ 不好的结局描述：
"你的综合评分是 0.85 分，获得了最佳结局。"

✅ 好的结局描述：
"毕业典礼上，你站在台上发表致辞，看着台下的学弟学妹们，想起了四年前你第一次
走进这个校园的样子。那时的迷茫、焦虑和困惑，在一篇篇论文、一次次组会、一个个
深夜的辛苦中，都化成了今天的成就。"
```

结局描述应该**回应玩家的经历**，而不只是报告数据。

## 特殊结局（可选）

除了评分结局，可以设计基于特定条件的特殊路线结局：

```typescript
{
  id: 'ending_viral_paper',
  title: '一夜爆红',
  description: '你的研究意外登上了热搜...',
  type: 'good',
  condition: {
    attributes: {
      paper_count: { min: 3 },  // 至少发了 3 篇论文
      academic_passion: { min: 90 },  // 且学术热情极高
    }
  }
}
```

特殊结局让玩家有"刷成就"的动力。
